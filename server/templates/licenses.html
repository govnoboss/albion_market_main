{% extends "base.html" %}

{% block title %}–ö–ª—é—á–∏ - GBot Admin{% endblock %}

{% block head %}
<style>
    .badge-online {
        background-color: #3fb950;
        color: white;
        animation: pulse 2s infinite;
    }

    .row-online {
        background-color: rgba(63, 185, 80, 0.05);
    }

    @keyframes pulse {
        0% {
            opacity: 1;
        }

        50% {
            opacity: 0.7;
        }

        100% {
            opacity: 1;
        }
    }
</style>
{% endblock %}

{% block content %}
<h1>üìã –í—Å–µ –∫–ª—é—á–∏</h1>

<div class="filters">
    <form method="GET" class="filter-form">
        <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á—É –∏–ª–∏ HWID..." value="{{ search }}">
        <select name="status">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="active" {% if status_filter=='active' %}selected{% endif %}>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
            <option value="expired" {% if status_filter=='expired' %}selected{% endif %}>–ò—Å—Ç—ë–∫—à–∏–µ</option>
            <option value="unbound" {% if status_filter=='unbound' %}selected{% endif %}>–ù–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã</option>
        </select>
        <button type="submit" class="btn btn-secondary">–§–∏–ª—å—Ç—Ä</button>
    </form>
</div>

<table class="licenses-table">
    <thead>
        <tr>
            <th>–ö–ª—é—á</th>
            <th> HWID / IP</th>
            <th>–ò—Å—Ç–µ–∫–∞–µ—Ç</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>
    <tbody>
        {% for license in licenses %}
        <tr
            class="{% if not license.is_active %}row-disabled{% endif %} {% if license.is_online %}row-online{% endif %}">
            <td class="key-cell">
                <code class="full-key">{{ license.key }}</code>
                <button class="btn btn-sm btn-copy"
                    onclick="navigator.clipboard.writeText('{{ license.key }}'); this.textContent='‚úì'; setTimeout(() => this.textContent='üìã', 1000)">üìã</button>
            </td>
            <td class="hwid-cell">
                {% if license.hwid %}
                <div class="hwid-container">
                    <code class="full-hwid">{{ license.hwid }}</code>
                    {% if license.last_ip %}
                    <br><span class="ip-address text-muted" style="font-size: 0.85em;">IP: {{ license.last_ip }}</span>
                    {% endif %}
                </div>
                {% else %}
                <span class="text-muted">‚Äî</span>
                {% endif %}
            </td>
            <td>{{ license.expires_at.strftime('%d.%m.%Y %H:%M') }}</td>
            <td>
                {% if license.is_online %}
                <span class="badge badge-online">üü¢ –û–Ω–ª–∞–π–Ω</span>
                {% endif %}

                {% if not license.is_active %}
                <span class="badge badge-disabled">–û—Ç–∫–ª—é—á—ë–Ω</span>
                {% elif license.is_expired %}
                <span class="badge badge-expired">–ò—Å—Ç—ë–∫</span>
                {% elif not license.hwid %}
                <span class="badge badge-unbound">–ù–æ–≤—ã–π</span>
                {% else %}
                <span class="badge badge-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                {% endif %}
            </td>
            <td class="actions-cell">
                {% if license.is_active %}
                <form method="POST" action="/admin/deactivate/{{ license.key }}" style="display:inline">
                    <button type="submit" class="btn btn-warning btn-sm" title="–û—Ç–∫–ª—é—á–∏—Ç—å">‚è∏</button>
                </form>
                {% endif %}
                <form method="POST" action="/admin/delete/{{ license.key }}" style="display:inline"
                    onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–ª—é—á {{ license.key[:8] }}...?')">
                    <button type="submit" class="btn btn-danger btn-sm" title="–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞">üóë</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}